jdk:
- openjdk8
language: scala
scala:
- 2.13.1
- 2.12.11
- 2.11.12
jobs:
  include:
  - stage: check
    env: ISOLATED=true
    scala: 2.13.1
    script: sbt scalafmtCheckAll || { echo "[error] Unformatted code found. Please
      run 'scalafmtAll' and commit the reformatted code."; false; }
    name: Code style check (fixed with `sbt scalafmtAll`)
  - script: sbt scalafmtSbtCheck || { echo "[error] Unformatted sbt code found. Please
      run 'scalafmtSbt' and commit the reformatted code."; false; }
    name: Build code style check (fixed with `sbt scalafmtSbt`)
  - stage: docs
    name: Push documentation to ghpages
    env: ISOLATED=true
    scala: 2.13.1
    script:
    - git config --global user.name "$USER"
    - git config --global user.email "$TRAVIS_BUILD_NUMBER@$TRAVIS_COMMIT"
    - openssl aes-256-cbc -K $encrypted_91e912197555_key -iv $encrypted_91e912197555_iv
      -in .travis/secrets.tar.enc -out .travis/secrets.tar -d
    - tar xv -C .travis -f .travis/secrets.tar;
    - chmod 600 .travis/local.travis-deploy-key
    - eval "$(ssh-agent -s)"
    - ssh-add .travis/local.travis-deploy-key
    - sbt ";docs/makeSite; docs/ghpagesPushSite"
  - stage: deploy
    name: Deploy to Bintray
    script:
    - openssl aes-256-cbc -K $encrypted_91e912197555_key -iv $encrypted_91e912197555_iv
      -in .travis/secrets.tar.enc -out .travis/secrets.tar -d
    - tar xv -C .travis -f .travis/secrets.tar;
    - mkdir -p $HOME/.sbt/gpg && cp .travis/local.pubring.asc $HOME/.sbt/gpg/pubring.asc
      && cp .travis/local.secring.asc $HOME/.sbt/gpg/secring.asc
    - sbt ++$TRAVIS_SCALA_VERSION releaseEarly
stages:
- name: check
  if: NOT tag =~ ^v
- test
- name: docs
  if: tag =~ ^v
- name: deploy
  if: tag =~ ^v
before_cache:
- rm -fv $HOME/.ivy2/.sbt.ivy.lock
- rm -fv $HOME/.sbt/ghpages
- rm -fv $HOME/.sbt/gpg
- find $HOME/.ivy2/cache -name "ivydata-*.properties" -print -delete
- find $HOME/.sbt        -name "*.lock"               -print -delete
cache:
  directories:
  - "$HOME/.cache/coursier"
  - "$HOME/.ivy2/cache"
  - "$HOME/.sbt/boot"
  - "$HOME/.sbt/launchers"
env:
  global:
  - secure: EgACV4m+UwYtUd8JNu+XOB9amP7RbZ/hW8wAzok020Th3LnYcP9Ps3fzODiEkSHdMqX4nvrYVdnvaF/XY+u/MjIXNieyuajMJn67/I+4wt2eLUmVEBfA6rCTirVdO0q0N7CrAXFh1gTV+CeefHoV1z8mLiqIkkM4BP1SjPaMCXa6MgE5iA22Atckv6fcJkjWyGpOtVC4Hpa7iOzeOorIUgXkquq1WouEg5807bxlZFwAHB2wG4/Vhh2yhqm0bfz5ON61O5ZfDXTUHXvO/RgmObBEBPudSQeqGcRMo7R7tTE8GrXWXKw401JYl0BkKkstVDwbaeFaAF9m4tjT1lDIqQaBzLXE/7CnEt15CKkjepKtqJlcCMPjrZ3m1737ngNim7aF5OJXWAyCH7ErlxPdPhBKZr/dP2JoQGxpMBNZTuld8VPwR3+K4hgB64jG+1LJV1+vYa0dVyTlzvtiV0H6Bfd1QNMwHRkCMHd3vTiUAOCuflgENE/5zBM0VUolQYzfxetJz8mewcFk36jspdzz3dLRY8asty3t27KCL+T0I1EPiR4azwn49Gjq0h+GYz9dTeYieFRiCra/96mkaTB9LdXdphVXgd5OehRSSfmEgyUzXoV/AGDPYqUVpSsVdFv7nBxKpGNzmy8+rz/9QOIgb5vqaJqSUc6uzEP/HRzVglU=
  - secure: Ln5X2ahXnejs08cAjU7PxQpsbU405POVkd9uESCC2y76JE07meJSO7OJS+VbUrXFiDAN5Yp9bPGXsee9D2XZWm8WBXX3znwfmZ3+YUHPANTypVnOe6RQMUI83Q1yt07YDQf6PcQdbgWgLcZ7uv9LTahNPKU0c/2KkCRMlCodw6ZTjpQFPYBqU+w4QeGRi64kVRiH8vk67s7/RaXnf1BbZ5H0hZUa1nUyDEHO6ql7AE9BshnJd7H44SVvGZQWOMkes3E9kWfvNvAQBKhUK25Mfg7xMpW3rjpzb3EzY8zQPyi0XhZBpvfJZtyeGAd8D4ajtsfcxH5g05T80dkU5uauAb8/8Fccr8q4WPA4ASsKTYhwpvfeHEMVw0LSWcJS1E/xmkZLNCg83zNC/gLgzDGb+LQoELPtsng7VIwucuHyOVsm252vs5uY/d7KpR1+zdrgpg5p0lVbigQ0pA5nt2MD/A6ItqSiMvJcDSlf4GlGAXxC/hM1jwZ9lyW2KZSLsJwUgs0nrXFDbhN5LeZo8NK9SLNPyyFt/yZ0i7kbplFBv+aouJjUKsKuTIQXeo/3DAChMx7dyF2D+upMfCPyz2K6PA95NpbJ0RsMq3iKW7YhK4Qa08dJl4rPhVb4coCHWvmKkwNQDp2rByHJXC7cwrsl3DEqyd5MoEKCKWqwr0iH2e4=
  - secure: NAoTr1dbqIYd4hZsXisZAseAQHTzc3xO+0Pc1O+GbPRVHKcMjk/jXyCNGYZUg8fWvII6pbBOWV6HIl+I+ot2CMpuxUTFp0J/kGTpmkoGr1OfEZLIek2blPHHlAKNxEWqiADbKROGfHmDdwpmZfE6dZaTsvkvdYw/SDtDavXPK2LQr4xRTu0G7UD4m4+l4srURqVoJQ2119A5gkG+cInxbw/y/Yk5YzUHd9z8a5rqOyMBpQSyA6xB8i4NHBh4UTT+IC4Dg148PtuF6KEoFdDpu2vtwLy7DAXUwq1uKfEJUJJnTaB7fMc7Hz7uV38x6RE4eOjJPb+O2YSm8vahS42BpSAdF4DII5YZzrZY4/2qAzgSZDF7Xj+RM7B/pYyKM1fR2AqAGBQmzjr5oErFlvjLTFvU55jQmfuTYJqFJe+wK15ZAQFEQoprfa85RvvdeG9XHUTT1gXeViCqCJWx204+Lbg08UGxnEu3wMmcWyDrfkYzP8YwGuW1kTzrvZ3NpBHeszxAqDc+5TSrd8Y6WvSaBDe4rgPicg2gY0/tXOuKNmyQIHA9GXDTP8o/g5wZW0td312BbBRXhwV91TIsGEqHtAhF4V4AByxUkinnxyx2ULiP0YJIpIiDkCbjJHqhnEc6n59QSiXf1LI6KtG6a+WYqPknBxRhO9EL99AYrEGLydo=
