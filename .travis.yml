jdk:
- openjdk8
language: scala
scala:
- 2.13.1
- 2.12.11
- 2.11.12
jobs:
  include:
  - stage: check
    env: ISOLATED=true
    scala: 2.13.1
    script: sbt scalafmtCheckAll || { echo "[error] Unformatted code found. Please
      run 'scalafmtAll' and commit the reformatted code."; false; }
    name: Code style check (fixed with `sbt scalafmtAll`)
  - script: sbt scalafmtSbtCheck || { echo "[error] Unformatted sbt code found. Please
      run 'scalafmtSbt' and commit the reformatted code."; false; }
    name: Build code style check (fixed with `sbt scalafmtSbt`)
  - stage: docs
    name: Push documentation to ghpages
    env: ISOLATED=true
    scala: 2.13.1
    script:
    - git config --global user.name "$USER"
    - git config --global user.email "$TRAVIS_BUILD_NUMBER@$TRAVIS_COMMIT"
    - openssl aes-256-cbc -K $encrypted_91e912197555_key -iv $encrypted_91e912197555_iv
      -in .travis/secrets.tar.enc -out .travis/secrets.tar -d
    - tar xv -C .travis -f .travis/secrets.tar;
    - chmod 600 .travis/local.travis-deploy-key
    - eval "$(ssh-agent -s)"
    - ssh-add .travis/local.travis-deploy-key
    - sbt ";docs/makeSite; docs/ghpagesPushSite"
  - stage: deploy
    name: Deploy to Bintray
    script:
    - openssl aes-256-cbc -K $encrypted_91e912197555_key -iv $encrypted_91e912197555_iv
      -in .travis/secrets.tar.enc -out .travis/secrets.tar -d
    - tar xv -C .travis -f .travis/secrets.tar;
    - mkdir -p $HOME/.sbt/gpg && cp .travis/local.pubring.asc $HOME/.sbt/gpg/pubring.asc
      && cp .travis/local.secring.asc $HOME/.sbt/gpg/secring.asc
    - sbt ++$TRAVIS_SCALA_VERSION releaseEarly
stages:
- name: check
  if: NOT tag =~ ^v
- test
- name: docs
  if: tag =~ ^v
- name: deploy
  if: tag =~ ^v
before_cache:
- rm -fv $HOME/.ivy2/.sbt.ivy.lock
- rm -fv $HOME/.sbt/ghpages
- rm -fv $HOME/.sbt/gpg
- find $HOME/.ivy2/cache -name "ivydata-*.properties" -print -delete
- find $HOME/.sbt        -name "*.lock"               -print -delete
cache:
  directories:
  - "$HOME/.cache/coursier"
  - "$HOME/.ivy2/cache"
  - "$HOME/.sbt/boot"
  - "$HOME/.sbt/launchers"
env:
  global:
  - secure: kOGQJ750/bjzfVMZFqan4zJ6rc7WKCByNnSr63xbG7fAhdTT6aKbkV1CBqJLesmtNdFDVr+sRS/yEzF2Id60/2CL4VB2XA9JWG9P2wko7MYz1UqZnNkH+x1eqtggp4N2odLIv69BXwaxKST/0QUG6ts5kIbP3BU9nB2mH3XvDdV8CccWioXxarDf9Ut88lu0jq/dA002jAntVp+GOiEDF6DUT/UdUvXGIoUM/Np1m/i77olAx6D7rd9RvHRBsUBiyUq8mmeToqky/zoQJ9rQ+RkT4xsiarlyAB6Uu7kJC3pQy4ZGtA6FqoKXvFB0m7KKi7Rq9AuYAlBHzRLPaV44bxwcK+M+UX7e27ggT/lm/vf1lCVzKOqE74B9KoV5edgZTA4iF8o5V1zn74SLQsXcJq8hTTScqYehm/YVVw20aWkMDo0d5867y6YV42+CZJ7hVy50yO0hYJl3L0BJz5eOpvCsNSFPjECBNtZvGmXZCevFbyz7lLHBjWTbeuTHiWhYAR8iYhVHXJ3JjCVTXY1MhKV7L2nebN/6ViUJOrWNDaeQ6h5IPHrE4tdNpQ/5DlUtYH4wfArp2oB9FLO1T3wKmk6U/9XKF3pHBt4cUM1RwrOvOMuf4A/QT20IVxHuNDq9HrLBFz1mOQkbKHVqTQoQHfI9C2s5h4PFb7Crawzq508=
  - secure: c1rCSR7uaJe14zaL8AEhTC8IyXRDf+NOTF3fFV/taE0KRsyQ7hJfLfM2gmXYkhn51QRSwaUZ4Au1dx/fDGedbmeEgrIr58RUi8kiDpnBMaOOfP7F/lZRrtEwDTYdFJGOcNKIxcQXjwE++jEhc1SzxQO1FVxf0y/jFubSOttDizmpDZUEu6iaZzlUfC8fooWI6x2dWJ6/I1XcFnDIJ15Ibei7agcI8Dy+eSxmMt2rZh9pc/KWHWubfZ6N4cTAO8dI0YNiI5iI9LT9pHpKJeUjsOLcSpb6XyRCJQHOuM923CrBwj6oDtTM1byWqKqVONgxqrR+ytOO8nGvVLMm5ia0ZSniiDInVBwNfgoRqhjseyjzXX+EHI0FAKetoQV9yV8kHziLnrwamPCST3so8+5jd63uBrOrCJDeNcg5G6DBuTpUHKLBU2LOGpuV4zX6w4BCFjeLcC6GXhgBmfW27UO04uZWddCNPh/zONytLIIzbiYdMnEM+xFmo4WJlXHGAk49V8dDwP9h9gWIoXB1osrKBuSK/OtvM+eebObmJFOSxapIVVIa3AMfSx98QeQ7W4tKrIOA+Wsrq9CEiofNc/kSQCZIUnIAv+oAQb9CpNlNx31GI+XGtc7jb6HZJLVROqm9mD4zxQqubgjoU3elXv09CeKAwxqrZTUcoE4lknMfNG4=
  - secure: b0+JjEctiQa6aJGv7wHBAD3xeb6VloEeVRGVuCH9IjkuL8JSkr1mDT1uW0t1M/wLS9fwGEJP2JPG3D+wJiCIQt4YoEpZUSjxLnOtfszs/H01e/MMIpJ65MoKnkRnBbRAjQPpcLTeq5Y5L+kZsfzZOGjxGW2f5G81mwvDCXFOmrOoA6+zmrVKK5+Kw0RImAWiPEPPibb2bq7HAUBzi0p9I0beV8TN+6tmc2Ocaae6iUSgBezfEcTZD9dEqR4bE4zO93jfk0pw+qxyryAyzXm02ofJmGIMD7DlZ5ImbbC1cOoJqD1pxUaAGM/BEkCXZrRYwKXkHrMLws84jumhhF6fTUQKcT/mCug0r9JysVU4upkrISyUmyFL0IVPCCV/XgIPsKm3u0otcNVCPAkzSw+G02Czkf1YnKRUkb57bFM6/QenZF0z+jAFstUrekAOwUKIJ+I+zeTaM0AGJWae8000Mz90JS3fSFjKCpUgjoO4WeSUuyG0pm50eX/trPOryXRjVmmPaYbV2b6ZIS81BEp9x0sP9M9RvSgo20Zi+tEaaiJO+Y4iQgcVm81mp08R+UfICgdTq+1NUbHilXoGGCbWn4zsR0un4qfmuqW7qiqM4ETQ9U+XMSHdhuS1KpRjw3C0xqSvtJ+07l2oDEzYmsV9j4yX0Hs3ZOEgoLI6O554nkw=
