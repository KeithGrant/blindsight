<!DOCTYPE html>
<html class="no-js" lang="en">

<head>
<title>Flow API · Blindsight</title>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<meta name="description" content='docs'/>
<link href="https://fonts.googleapis.com/css?family=Roboto:100normal,100italic,300normal,300italic,400normal,400italic,500normal,500italic,700normal,700italic,900normal,900italicc" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../lib/jquery/jquery.min.js"></script>
<script type="text/javascript" src="../js/page.js"></script>
<script type="text/javascript" src="../js/warnOldVersion.js"></script>
<script type="text/javascript" src="../js/groups.js"></script>
<link rel="stylesheet" type="text/css" href="../lib/foundation/dist/foundation.min.css"/>
<link rel="stylesheet" type="text/css" href="../css/page.css"/>

<!--
<link rel="shortcut icon" href="../images/favicon.ico" />
-->
</head>

<body>
<div class="off-canvas-wrapper">
<div class="off-canvas-wrapper-inner" data-off-canvas-wrapper>

<div class="off-canvas position-left" id="off-canvas-menu" data-off-canvas>
<nav class="off-canvas-nav">
<div class="nav-home">
<a href="../index.html" >
<span class="home-icon">⌂</span>Blindsight
</a>
<div class="version-number">
0.1.0*
</div>
</div>
<div class="nav-toc">
<ul>
  <li><a href="../setup/index.html" class="page">Setup</a></li>
  <li><a href="../usage/index.html" class="page">Usage</a>
  <ul>
    <li><a href="../usage/api.html" class="page">SLF4J API</a></li>
    <li><a href="../usage/logstash.html" class="page">Logstash Type Classes</a></li>
    <li><a href="../usage/fluent.html" class="page">Fluent API</a></li>
    <li><a href="../usage/semantic.html" class="page">Semantic API</a></li>
    <li><a href="../usage/flow.html" class="active page">Flow API</a></li>
    <li><a href="../usage/context.html" class="page">Context</a></li>
    <li><a href="../usage/conditional.html" class="page">Conditional Logging</a></li>
  </ul></li>
  <li><a href="../extending/index.html" class="page">Extending</a></li>
</ul>
</div>

</nav>
</div>

<div class="off-canvas-content" data-off-canvas-content>

<header class="site-header expanded row">
<div class="small-12 column">
<a href="#" class="off-canvas-toggle hide-for-medium" data-toggle="off-canvas-menu"><svg class="svg-icon svg-icon-menu" version="1.1" id="Menu" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 20 20" enable-background="new 0 0 20 20" xml:space="preserve"> <path class="svg-icon-menu-path" fill="#53CDEC" d="M16.4,9H3.6C3.048,9,3,9.447,3,10c0,0.553,0.048,1,0.6,1H16.4c0.552,0,0.6-0.447,0.6-1C17,9.447,16.952,9,16.4,9z M16.4,13
H3.6C3.048,13,3,13.447,3,14c0,0.553,0.048,1,0.6,1H16.4c0.552,0,0.6-0.447,0.6-1C17,13.447,16.952,13,16.4,13z M3.6,7H16.4
C16.952,7,17,6.553,17,6c0-0.553-0.048-1-0.6-1H3.6C3.048,5,3,5.447,3,6C3,6.553,3.048,7,3.6,7z"/></svg>
</a>
<div class="title"><a href="../index.html">Blindsight</a></div>

<!--
<a href="https://www.example.com" class="logo show-for-medium">logo</a>
-->
</div>
</header>

<div class="expanded row">

<div class="medium-3 large-2 show-for-medium column">
<nav class="site-nav">
<div class="nav-home">
<a href="../index.html" >
<span class="home-icon">⌂</span>Blindsight
</a>
<div class="version-number">
0.1.0*
</div>
</div>
<div class="nav-toc">
<ul>
  <li><a href="../setup/index.html" class="page">Setup</a></li>
  <li><a href="../usage/index.html" class="page">Usage</a>
  <ul>
    <li><a href="../usage/api.html" class="page">SLF4J API</a></li>
    <li><a href="../usage/logstash.html" class="page">Logstash Type Classes</a></li>
    <li><a href="../usage/fluent.html" class="page">Fluent API</a></li>
    <li><a href="../usage/semantic.html" class="page">Semantic API</a></li>
    <li><a href="../usage/flow.html" class="active page">Flow API</a></li>
    <li><a href="../usage/context.html" class="page">Context</a></li>
    <li><a href="../usage/conditional.html" class="page">Conditional Logging</a></li>
  </ul></li>
  <li><a href="../extending/index.html" class="page">Extending</a></li>
</ul>
</div>

</nav>
</div>

<div class="small-12 medium-9 large-10 column">
<section class="site-content">

<span id="version-warning"></span>

<div class="page-header row">
<div class="medium-12 show-for-medium column">
<div class="nav-breadcrumbs">
<ul>
  <li><a href="../index.html">Blindsight</a></li>
  <li><a href="../usage/index.html">Usage</a></li>
  <li>Flow API</li>
</ul>
</div>
</div>
</div>

<div class="page-content row">
<div class="small-12 large-9 column" id="docs">
<h1><a href="#flow-api" name="flow-api" class="anchor"><span class="anchor-link"></span></a>Flow API</h1>
<p>The flow API is used when logging surrounds an execution flow.</p>
<p>You can access the flow logger from Blindsight using <code>logger.flow</code>:</p>
<pre class="prettyprint"><code class="language-scala">import com.tersesystems.blindsight._

val logger = LoggerFactory.getLogger
val flowLogger = logger.flow
</code></pre>
<h2><a href="#usage" name="usage" class="anchor"><span class="anchor-link"></span></a>Usage</h2>
<p>The flow logger takes a block of execution, and returns the result transparently, according to the log level.</p>
<pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/tersesystems/blindsight/tree/master/docs/src/main/paradox/usage/flow/Flow.scala#L35-L37" target="_blank" title="Go to snippet source"></a><code class="language-scala">def flowMethod(arg1: Int, arg2: Int): Int = logger.flow.trace {
  arg1 + arg2
}</code></pre>
<p>The result must have a type class instance of <code>ToArguments</code>, so that it can be considered in logging. For example, if the return type is <code>Person</code>, then you must have a <code>ToArguments[Person]</code> in scope:</p>
<pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/tersesystems/blindsight/tree/master/docs/src/main/paradox/usage/flow/Flow.scala#L41-L51" target="_blank" title="Go to snippet source"></a><code class="language-scala">def personFlowMethod(arg1: Int, arg2: Int): Person = logger.flow.trace {
  Person(name = &quot;Will&quot;, age = arg1 + arg2)
}

case class Person(name: String, age: Int)

object Person {
  implicit val personToArguments: ToArguments[Person] = ToArguments { person =&gt;
    Arguments(kv(&quot;person&quot;, person.name), kv(&quot;age&quot;, person.age))
  }
}</code></pre>
<p>If logging is enabled, then the execution is wrapped to capture the result or execution, and then the result is returned or execution rethrown. If the logging level is not enabled or logging execution is denied by a filter, then execution of the block still proceeds but is not wrapped by a <code>Try</code> block.</p>
<p>Because this logger executes blocks of computation and may optionally decorate it with logging, it does <b>not</b> implement the <code>OnConditionMixin</code> and should not be used with conditional logging logic. If conditional logging is required, it is generally safer to do it in the logging framework by using a deny filter with a marker defined in the FlowBehavior.</p>
<h2><a href="#flow-behavior" name="flow-behavior" class="anchor"><span class="anchor-link"></span></a>Flow Behavior</h2>
<p>Implementing a flow behavior comes down to creating <code>Markers</code> and <code>Statements</code> for entry, exit, and exceptions.</p>
<pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/tersesystems/blindsight/tree/master/docs/src/main/paradox/usage/flow/SimpleFlowBehavior.scala#L4-L32" target="_blank" title="Go to snippet source"></a><code class="language-scala">class SimpleFlowBehavior[B: ToArgument] extends FlowBehavior[B] {

  override def createEntryStatement(source: Source): Option[Statement] = {
    import com.tersesystems.blindsight.logstash.ToArgumentsImplicits._
    Some(
      Statement()
        .withMarkers(entryMarkers(source))
        .withMessage(s&quot;${source.enclosing.value} entry {}&quot;)
        .withArguments(source.args)
    )
  }

  override def createThrowingStatement(throwable: Throwable, source: Source): Option[Statement] = {
    Some(
      Statement()
        .withThrowable(throwable)
        .withMessage(s&quot;${source.enclosing.value} exception&quot;)
    )
  }

  override def createExitStatement(resultValue: B, source: Source): Option[Statement] = {
    Some(
      Statement()
        .withMarkers(exitMarkers(source))
        .withMessage(s&quot;${source.enclosing.value} exit with result {}&quot;)
        .withArguments(resultValue)
    )
  }
}</code></pre>
<p>From there, using the flow API is a matter of plugging in the relevant flow behavior.</p>
<pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/tersesystems/blindsight/tree/master/docs/src/main/paradox/usage/flow/Flow.scala#L20-L53" target="_blank" title="Go to snippet source"></a><code class="language-scala">object Flow {

  private implicit def flowBehavior[B: ToArguments]: FlowBehavior[B] = new SimpleFlowBehavior

  def main(args: Array[String]): Unit = {
    logger.info(&quot;About to execute number flow&quot;)
    val intResult = flowMethod(1, 2)
    println(&quot;This is &quot; + intResult)

    logger.info(&quot;About to execute person flow&quot;)
    val personResult = personFlowMethod(1, 2)
    println(&quot;This is &quot; + personResult)
  }

  def flowMethod(arg1: Int, arg2: Int): Int = logger.flow.trace {
    arg1 + arg2
  }

  def personFlowMethod(arg1: Int, arg2: Int): Person = logger.flow.trace {
    Person(name = &quot;Will&quot;, age = arg1 + arg2)
  }

  case class Person(name: String, age: Int)

  object Person {
    implicit val personToArguments: ToArguments[Person] = ToArguments { person =&gt;
      Arguments(kv(&quot;person&quot;, person.name), kv(&quot;age&quot;, person.age))
    }
  }
}</code></pre>
<p>This produces the following output:</p>
<pre class="prettyprint"><code class="nocode">FgcMMra7u2U6O0Qbm7EAAA 17:00:47.067 [INFO ] e.flow.FlowMain -  About to execute number flow
FgcMMra7u8QdHaINzdiAAA 17:00:47.166 [TRACE] e.flow.FlowMain -  example.flow.FlowMain.flowMethod entry source.arguments={arg1=1, arg2=2}
FgcMMra7u9CdHaINzdiAAA 17:00:47.191 [TRACE] e.flow.FlowMain -  example.flow.FlowMain.flowMethod exit with result 3
This is 3
</code></pre>
<div class="source-github">
The source code for this page can be found <a href="https://github.com/tersesystems/blindsight/tree/master/docs/src/main/paradox/usage/flow.md">here</a>.
</div>

<div class="nav-next">
<p><strong>Next:</strong> <a href="../usage/context.html">Context</a></p>
</div>
</div>
<div class="large-3 show-for-large column" data-sticky-container>
<nav class="sidebar sticky" data-sticky data-anchor="docs" data-sticky-on="large">
<div class="page-nav">
<div class="nav-title">On this page:</div>
<div class="nav-toc">
<ul>
  <li><a href="../usage/flow.html#flow-api" class="header">Flow API</a>
  <ul>
    <li><a href="../usage/flow.html#usage" class="header">Usage</a></li>
    <li><a href="../usage/flow.html#flow-behavior" class="header">Flow Behavior</a></li>
  </ul></li>
</ul>
</div>
</div>
</nav>
</div>
</div>

</section>
</div>

</div>

<footer class="site-footer">

<section class="site-footer-nav">
<div class="expanded row">
<div class="small-12 large-offset-2 large-10 column">
<div class="row site-footer-content">

<div class="small-12 medium-4 large-3 text-center column">
<div class="nav-links">
<ul>
<!-- <li><a href="https://www.example.com/products/">Products</a> -->
</ul>
</div>
</div>

</div>
</div>
</div>
</section>

<section class="site-footer-base">
<div class="expanded row">
<div class="small-12 large-offset-2 large-10 column">
<div class="row site-footer-content">

<div class="small-12 text-center large-9 column">

<!--
<div class="copyright">
<span class="text">&copy; 2020</span>
<a href="https://www.example.com" class="logo">logo</a>
</div>
-->
</div>

</div>
</div>
</div>
</section>
</footer>

</div>
</div>
</div>
</body>

<script type="text/javascript" src="../lib/foundation/dist/foundation.min.js"></script>
<script type="text/javascript">jQuery(document).foundation();</script>
<script type="text/javascript" src="../js/magellan.js"></script>

<style type="text/css">@import "../lib/prettify/prettify.css";</style>
<script type="text/javascript" src="../lib/prettify/prettify.js"></script>
<script type="text/javascript" src="../lib/prettify/lang-scala.js"></script>
<script type="text/javascript">jQuery(function(){window.prettyPrint && prettyPrint()});</script>
<script type="text/javascript">jQuery(function(jq){initOldVersionWarnings(jq, '0.1.0-SNAPSHOT', '')});</script>


</html>
