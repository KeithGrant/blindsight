<!DOCTYPE html>
<html class="no-js" lang="en">

<head>
<title>Usage · Blindsight</title>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<meta name="description" content='docs'/>
<link rel="canonical" href="https:/tersesystems.github.io/blindsight/usage/index.html"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:100normal,100italic,300normal,300italic,400normal,400italic,500normal,500italic,700normal,700italic,900normal,900italicc" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../lib/jquery/jquery.min.js"></script>
<script type="text/javascript" src="../js/page.js"></script>
<script type="text/javascript" src="../js/warnOldVersion.js"></script>
<script type="text/javascript" src="../js/groups.js"></script>
<link rel="stylesheet" type="text/css" href="../lib/foundation/dist/foundation.min.css"/>
<link rel="stylesheet" type="text/css" href="../css/page.css"/>

<!--
<link rel="shortcut icon" href="../images/favicon.ico" />
-->
</head>

<body>
<div class="off-canvas-wrapper">
<div class="off-canvas-wrapper-inner" data-off-canvas-wrapper>

<div class="off-canvas position-left" id="off-canvas-menu" data-off-canvas>
<nav class="off-canvas-nav">
<div class="nav-home">
<a href="../index.html" >
<span class="home-icon">⌂</span>Blindsight
</a>
<div class="version-number">
0.1.0*
</div>
</div>
<div class="nav-toc">
<ul>
  <li><a href="../setup/index.html" class="page">Setup</a></li>
  <li><a href="../usage/index.html" class="active page">Usage</a>
  <ul>
    <li><a href="../usage/api.html" class="page">SLF4J API</a></li>
    <li><a href="../usage/fluent.html" class="page">Fluent API</a></li>
    <li><a href="../usage/semantic.html" class="page">Semantic API</a></li>
    <li><a href="../usage/flow.html" class="page">Flow API</a></li>
    <li><a href="../usage/context.html" class="page">Context</a></li>
    <li><a href="../usage/conditional.html" class="page">Conditional Logging</a></li>
    <li><a href="../usage/logstash.html" class="page">Logstash Type Class Mappings</a></li>
  </ul></li>
  <li><a href="../extending/index.html" class="page">Extending</a></li>
</ul>
</div>

</nav>
</div>

<div class="off-canvas-content" data-off-canvas-content>

<header class="site-header expanded row">
<div class="small-12 column">
<a href="#" class="off-canvas-toggle hide-for-medium" data-toggle="off-canvas-menu"><svg class="svg-icon svg-icon-menu" version="1.1" id="Menu" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 20 20" enable-background="new 0 0 20 20" xml:space="preserve"> <path class="svg-icon-menu-path" fill="#53CDEC" d="M16.4,9H3.6C3.048,9,3,9.447,3,10c0,0.553,0.048,1,0.6,1H16.4c0.552,0,0.6-0.447,0.6-1C17,9.447,16.952,9,16.4,9z M16.4,13
H3.6C3.048,13,3,13.447,3,14c0,0.553,0.048,1,0.6,1H16.4c0.552,0,0.6-0.447,0.6-1C17,13.447,16.952,13,16.4,13z M3.6,7H16.4
C16.952,7,17,6.553,17,6c0-0.553-0.048-1-0.6-1H3.6C3.048,5,3,5.447,3,6C3,6.553,3.048,7,3.6,7z"/></svg>
</a>
<div class="title"><a href="../index.html">Blindsight</a></div>

<!--
<a href="https://www.example.com" class="logo show-for-medium">logo</a>
-->
</div>
</header>

<div class="expanded row">

<div class="medium-3 large-2 show-for-medium column">
<nav class="site-nav">
<div class="nav-home">
<a href="../index.html" >
<span class="home-icon">⌂</span>Blindsight
</a>
<div class="version-number">
0.1.0*
</div>
</div>
<div class="nav-toc">
<ul>
  <li><a href="../setup/index.html" class="page">Setup</a></li>
  <li><a href="../usage/index.html" class="active page">Usage</a>
  <ul>
    <li><a href="../usage/api.html" class="page">SLF4J API</a></li>
    <li><a href="../usage/fluent.html" class="page">Fluent API</a></li>
    <li><a href="../usage/semantic.html" class="page">Semantic API</a></li>
    <li><a href="../usage/flow.html" class="page">Flow API</a></li>
    <li><a href="../usage/context.html" class="page">Context</a></li>
    <li><a href="../usage/conditional.html" class="page">Conditional Logging</a></li>
    <li><a href="../usage/logstash.html" class="page">Logstash Type Class Mappings</a></li>
  </ul></li>
  <li><a href="../extending/index.html" class="page">Extending</a></li>
</ul>
</div>

</nav>
</div>

<div class="small-12 medium-9 large-10 column">
<section class="site-content">

<span id="version-warning"></span>

<div class="page-header row">
<div class="medium-12 show-for-medium column">
<div class="nav-breadcrumbs">
<ul>
  <li><a href="../index.html">Blindsight</a></li>
  <li>Usage</li>
</ul>
</div>
</div>
</div>

<div class="page-content row">
<div class="small-12 large-9 column" id="docs">
<h1><a href="#usage" name="usage" class="anchor"><span class="anchor-link"></span></a>Usage</h1>
<p>This usage page will give a quick overview of Blindsight, rather than a deep drill down.</p>
<h2><a href="#api" name="api" class="anchor"><span class="anchor-link"></span></a>API</h2>
<p>The simplest possible <a href="/blindsight/api/com/tersesystems/blindsight/Logger.html" title="com.tersesystems.blindsight.Logger"><code>Logger</code></a> is created from a <a href="/blindsight/api/com/tersesystems/blindsight/LoggerFactory$.html" title="com.tersesystems.blindsight.LoggerFactory"><code>LoggerFactory</code></a>:</p>
<pre class="prettyprint"><code class="language-scala">import com.tersesystems.blindsight.LoggerFactory
val logger = LoggerFactory.getLogger(getClass)
logger.info(&quot;I am an SLF4J-like logger&quot;)
</code></pre>
<p>What does this do under the hood? It converts to a <code>Message</code> case class, and logs only if the level of the SLF4J logger is set to at least <code>INFO</code>. </p>
<p>Very roughly:</p>
<pre class="prettyprint"><code class="language-scala">val infoMethod: InfoMethod = logger.info
infoMethod.apply(() =&gt; Message(&quot;I am an SLF4J-like logger&quot;))

// rough implementation
class InfoMethod {
  def apply(msg: =&gt; Message) {
    if (slf4jLogger.isInfoEnabled()) {
       slf4jLogger.info(msg.message)
    }
  }
}
</code></pre>
<p>First, let&rsquo;s explain <code>Message</code> and its compatriots.</p>
<p>A single logging statement in SLF4J consists of a set of parameters in combination:</p>
<pre class="prettyprint"><code class="language-java">Marker marker = ...
String message = ...
Object[] arguments = ...
logger.info(marker, message, arguments);
</code></pre>
<p>All of these together make a logging statement.</p>
<p>Blindsight keeps the same concept these parameters, but creates specific types; <code>Markers</code>, <code>Message</code>, and <code>Arguments</code>, with a <code>Statement</code> that encompasses all the above.</p>
<pre class="prettyprint"><code class="language-scala">val markers = Markers(marker1, marker2)
val message = Message(&quot;some message&quot;)
val arguments = Arguments(&quot;arg1&quot;, 42, 1337)
</code></pre>
<p>Where possible, Blindsight provides type class mappings to automatically convert to the appropriate type. So <code>Markers</code> has a <code>ToMarkers</code> type class, <code>Message</code> has <code>ToMessage</code>, and so on.</p>
<p>You can use type class instances to extend Blindsight&rsquo;s functionality. For example, you can pass a feature flag into <code>isDebugEnabled</code> and it will convert it into a <code>Markers</code>:</p>
<pre class="prettyprint"><code class="language-scala">object Slf4jMain {
  final case class FeatureFlag(flagName: String)
  object FeatureFlag {
    implicit val toMarkers: ToMarkers[FeatureFlag] = ToMarkers { instance =&gt;
      Markers(MarkerFactory.getDetachedMarker(instance.flagName))
    }
  }

  def main(args: Array[String]): Unit = {
    val logger: Logger = LoggerFactory.getLogger(getClass)

    val featureFlag = FeatureFlag(&quot;flag.enabled&quot;)
    // this is not a marker, but is converted via type class.
    if (logger.isDebugEnabled(featureFlag)) {
      logger.debug(&quot;this is a test&quot;)
    }
  }
}
</code></pre>
<p>See the <a href="api.html">API</a> page for more details.</p>
<h2><a href="#logstash-type-class-mappings" name="logstash-type-class-mappings" class="anchor"><span class="anchor-link"></span></a>Logstash Type Class Mappings</h2>
<p>Blindsight provides a type class mapping which maps between tuples, arrays, and JSON nodes to <a href="https://github.com/logstash/logstash-logback-encoder#event-specific-custom-fields">Markers and StructuredArguments</a>, if you are using Logback as the SLF4J implementation. This makes structured logging easy and intuitive.</p>
<p>Automatic type class mapping is available through the <code>blindsight-logstash</code> library using <a href="../setup/index.html">setup</a>, and must be brought into lexical scope using the <code>Implicits</code> singleton object:</p>
<pre class="prettyprint"><code class="language-scala">import com.tersesystems.blindsight.logstash.Implicits._
</code></pre>
<p>This provides a number of type class mappings like:</p>
<pre class="prettyprint"><code class="language-scala">implicit val tupleStringToMarkers: ToMarkers[(String, String)] = ToMarkers {
  case (k, v) =&gt; Markers(LogstashMarkers.append(k, v))
}
</code></pre>
<p>When you write out a logstash marker using a tuple in the position of a marker, it will compile:</p>
<pre class="prettyprint"><code class="language-scala">logger.info(&quot;a&quot; -&gt; &quot;b&quot;, &quot;some message&quot;)
</code></pre>
<p>And when you are using the <code>LogstashEncoder</code> that writes out structured logs as JSON, you&rsquo;ll get the following:</p>
<pre class="prettyprint"><code class="language-json">{&quot;@timestamp&quot;:&quot;2020-04-05T23:09:08.436Z&quot;,&quot;@version&quot;:&quot;1&quot;,&quot;message&quot;:&quot;some message&quot;,&quot;logger_name&quot;:&quot;example.Main$&quot;,&quot;a&quot;:&quot;b&quot;}
</code></pre>
<p>See <a href="logstash.html">Type Class Mappings</a> for more details.</p>
<h2><a href="#fluent-api" name="fluent-api" class="anchor"><span class="anchor-link"></span></a>Fluent API</h2>
<p>A <code>com.tersesystems.blindsight.Logger</code> instance provides access to a fluent logger API.</p>
<p>To work as a fluent logger:</p>
<pre class="prettyprint"><code class="language-scala">import com.tersesystems.blindsight.fluent.FluentLogger

val fluentLogger: FluentLogger = logger.fluent
fluentLogger.info.message(&quot;I am a fluent logger&quot;).log()
</code></pre>
<p>See <a href="fluent.html">Fluent API</a> for details.</p>
<h2><a href="#semantic-api" name="semantic-api" class="anchor"><span class="anchor-link"></span></a>Semantic API</h2>
<p>The semantic API takes a single strongly typed argument, and the logger is instantiated with the type that is acceptable. This makes it very useful for event logging.</p>
<p>To work as a strongly typed logging API:</p>
<pre class="prettyprint"><code class="language-scala">import com.tersesystems.blindsight.api._
import com.tersesystems.blindsight.semantic.SemanticLogger

val semanticLogger: SemanticLogger[UserEvent] = logger.semantic[UserEvent]
val userLoggedInEvent = UserLoggedInEvent(name = &quot;steve&quot;)
semanticLogger.info(userEvent)
</code></pre>
<p>You can also use this API with <a href="https://github.com/fthomas/refined">refinement types</a>:</p>
<pre class="prettyprint"><code class="language-scala">import eu.timepit.refined.api.Refined
import eu.timepit.refined.collection.NonEmpty
import eu.timepit.refined.string._
import eu.timepit.refined._

implicit def stringToStatement[R]: ToStatement[Refined[String, R]] = ToStatement { str =&gt;
  Statement().withMessage(str.value)
}

val stringLogger = logger.semantic[String]
val urlLogger = stringLogger.refine[String Refined Url]
urlLogger.info(refineMV(&quot;https://tersesystems.com&quot;))
</code></pre>
<p>See <a href="semantic.html">Semantic API</a> for details.</p>
<h2><a href="#conditionals" name="conditionals" class="anchor"><span class="anchor-link"></span></a>Conditionals</h2>
<p>Most of the loggers have an <code>onCondition</code> method that returns a conditional logger of the same type.</p>
<p>This logger will only log if the condition is true:</p>
<pre class="prettyprint"><code class="language-scala">def booleanCondition: Boolean = ...
val conditionalLogger = logger.onCondition(booleanCondition)
conditionalLogger.info(&quot;Only logs when condition is true&quot;)
</code></pre>
<p>By contrast, <code>when</code> is used on methods, rather than the logger, and provides a block that is executed only when the condition is true:</p>
<pre class="prettyprint"><code class="language-scala">logger.info.when(booleanCondition) { info =&gt;
  info(&quot;log&quot;)
}
</code></pre>
<p>See <a href="conditional.html">Conditional Logging</a> for more details.</p>
<h2><a href="#flow" name="flow" class="anchor"><span class="anchor-link"></span></a>Flow</h2>
<p>The flow API is used to render the entry and exit of a given method. It is tied together with a flow behavior which provides the relevant <code>Statement</code> on entry and exit. This can also be used for timers and hierarchical tracing such as Opentracing.</p>
<pre class="prettyprint"><code class="language-scala">implicit def flowBehavior[B: ToArguments]: FlowBehavior[B] = ...

def flowMethod(arg1: Int, arg2: Int): Int = logger.flow.trace {
  arg1 + arg2
}
</code></pre>
<p>See <a href="flow.html">Flow API</a> for more details.</p>
<h2><a href="#context" name="context" class="anchor"><span class="anchor-link"></span></a>Context</h2>
<p>Blindsight builds up context with markers. You can use <code>withMarkers</code> to add markers that don&rsquo;t have to explicitly added to a statement.</p>
<pre class="prettyprint"><code class="language-scala">import net.logstash.logback.marker.{Markers =&gt; LogstashMarkers}
val loggerWithMarkers = logger.withMarker(LogstashMarkers.append(&quot;user&quot;, &quot;will&quot;))
</code></pre>
<p>See <a href="context.html">Context</a> for more details.</p>
<h2><a href="#underlying" name="underlying" class="anchor"><span class="anchor-link"></span></a>Underlying</h2>
<p>You can always get access to the underlying SLF4J logger by calling <code>logger.underlying</code>:</p>
<pre class="prettyprint"><code class="language-scala">val underlying: org.slf4j.Logger = logger.underlying
</code></pre>
<h2><a href="#logger-factory" name="logger-factory" class="anchor"><span class="anchor-link"></span></a>Logger Factory</h2>
<p>The easiest way to get at a logger is to use <code>LoggerFactory</code>. This looks like the SLF4J version, but is more flexible because it uses a <code>LoggerResolver</code> type class under the hood.</p>
<pre class="prettyprint"><code class="language-scala">import com.tersesystems.blindsight.LoggerFactory

val loggerFromName = LoggerFactory.getLogger(&quot;some.Logger&quot;)
val loggerFromClass = LoggerFactory.getLogger(getClass)
</code></pre>
<p>There is also a macro based version which finds the enclosing class name and hands it to you:</p>
<pre class="prettyprint"><code class="language-scala">val loggerFromEnclosing = LoggerFactory.getLogger
</code></pre>
<p>Finally, you also have the option of creating your own logger resolver. This is useful when you want to get away from class based logging, and use a naming strategy based on a correlation id.</p>
<pre class="prettyprint"><code class="language-scala">trait LoggerResolver[T] {
  def resolveLogger(instance: T): org.slf4j.Logger
}
</code></pre>
<p>means you can resolve a logger directly from a request:</p>
<pre class="prettyprint"><code class="language-scala">implicit val requestToResolver: LoggerResolver[Request] = (instance: Request) =&gt; {
    loggerFactory.getLogger(&quot;requests.&quot; + instance.requestId())
}
</code></pre>
<p>And from then on, you can do:</p>
<pre class="prettyprint"><code class="language-scala">val myRequest: Request = ...
val logger = LoggerFactory.getLogger(myRequest)
</code></pre>
<h2><a href="#compile-time-caller-info" name="compile-time-caller-info" class="anchor"><span class="anchor-link"></span></a>Compile Time Caller Info</h2>
<p>SLF4J can give access to the line and file of source code, but this is done at runtime and is very expensive. Blindsight provides this information for free, at compile time, through <a href="https://github.com/lihaoyi/sourcecode">sourcecode</a> macros, using the <code>SourceInfoMixin</code> on the logger.</p>
<pre class="prettyprint"><code class="language-scala">trait SourceInfoMixin {
  def sourceInfoMarker(
      level: Level,
      line: Line,
      file: File,
      enclosing: Enclosing
  ): Markers
}
</code></pre>
<p>When using <code>blindsight-generic</code>, this returns <code>Markers.empty</code>, but when using <code>blindsight-logstash</code>, this adds <code>source.line</code>, <code>source.file</code> and <code>source.enclosing</code> to the JSON logs automatically:</p>
<pre class="prettyprint"><code class="language-json">{
  &quot;@timestamp&quot;: &quot;2020-04-12T17:58:45.410Z&quot;,
  &quot;@version&quot;: &quot;1&quot;,
  &quot;message&quot;: &quot;this is a test&quot;,
  &quot;logger_name&quot;: &quot;example.slf4j.Slf4jMain$&quot;,
  &quot;thread_name&quot;: &quot;run-main-0&quot;,
  &quot;level&quot;: &quot;DEBUG&quot;,
  &quot;level_value&quot;: 10000,
  &quot;source.line&quot;: 39,
  &quot;source.file&quot;: &quot;/home/wsargent/work/blindsight/example/src/main/scala/example/slf4j/Slf4jMain.scala&quot;,
  &quot;source.enclosing&quot;: &quot;example.slf4j.Slf4jMain.main&quot;
}
</code></pre>
<p>This is the default behavior, and you can override <code>sourceInfoMarker</code> in your own implementation to return whatever you like.</p>
<div class="source-github">
The source code for this page can be found <a href="https://github.com/lightbend/paradox/tree/0.1.0-SNAPSHOT/docs/src/main/paradox/usage/index.md">here</a>.
</div>

<div class="nav-next">
<p><strong>Next:</strong> <a href="../usage/api.html">SLF4J API</a></p>
</div>
</div>
<div class="large-3 show-for-large column" data-sticky-container>
<nav class="sidebar sticky" data-sticky data-anchor="docs" data-sticky-on="large">
<div class="page-nav">
<div class="nav-title">On this page:</div>
<div class="nav-toc">
<ul>
  <li><a href="../usage/index.html#usage" class="header">Usage</a>
  <ul>
    <li><a href="../usage/index.html#api" class="header">API</a></li>
    <li><a href="../usage/index.html#logstash-type-class-mappings" class="header">Logstash Type Class Mappings</a></li>
    <li><a href="../usage/index.html#fluent-api" class="header">Fluent API</a></li>
    <li><a href="../usage/index.html#semantic-api" class="header">Semantic API</a></li>
    <li><a href="../usage/index.html#conditionals" class="header">Conditionals</a></li>
    <li><a href="../usage/index.html#flow" class="header">Flow</a></li>
    <li><a href="../usage/index.html#context" class="header">Context</a></li>
    <li><a href="../usage/index.html#underlying" class="header">Underlying</a></li>
    <li><a href="../usage/index.html#logger-factory" class="header">Logger Factory</a></li>
    <li><a href="../usage/index.html#compile-time-caller-info" class="header">Compile Time Caller Info</a></li>
  </ul></li>
</ul>
</div>
</div>
</nav>
</div>
</div>

</section>
</div>

</div>

<footer class="site-footer">

<section class="site-footer-nav">
<div class="expanded row">
<div class="small-12 large-offset-2 large-10 column">
<div class="row site-footer-content">

<div class="small-12 medium-4 large-3 text-center column">
<div class="nav-links">
<ul>
<!-- <li><a href="https://www.example.com/products/">Products</a> -->
</ul>
</div>
</div>

</div>
</div>
</div>
</section>

<section class="site-footer-base">
<div class="expanded row">
<div class="small-12 large-offset-2 large-10 column">
<div class="row site-footer-content">

<div class="small-12 text-center large-9 column">

<!--
<div class="copyright">
<span class="text">&copy; 2020</span>
<a href="https://www.example.com" class="logo">logo</a>
</div>
-->
</div>

</div>
</div>
</div>
</section>
</footer>

</div>
</div>
</div>
</body>

<script type="text/javascript" src="../lib/foundation/dist/foundation.min.js"></script>
<script type="text/javascript">jQuery(document).foundation();</script>
<script type="text/javascript" src="../js/magellan.js"></script>

<style type="text/css">@import "../lib/prettify/prettify.css";</style>
<script type="text/javascript" src="../lib/prettify/prettify.js"></script>
<script type="text/javascript" src="../lib/prettify/lang-scala.js"></script>
<script type="text/javascript">jQuery(function(){window.prettyPrint && prettyPrint()});</script>
<script type="text/javascript">jQuery(function(jq){initOldVersionWarnings(jq, '0.1.0-SNAPSHOT', '')});</script>


</html>
