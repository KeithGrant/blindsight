<!DOCTYPE html>
<html class="no-js" lang="en">

<head>
<title>Structured Logging · Blindsight</title>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<meta name="description" content='docs'/>
<link rel="canonical" href="/blindsight/usage/structured.html"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:100normal,100italic,300normal,300italic,400normal,400italic,500normal,500italic,700normal,700italic,900normal,900italicc" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../lib/jquery/jquery.min.js"></script>
<script type="text/javascript" src="../js/page.js"></script>
<script type="text/javascript" src="../js/warnOldVersion.js"></script>
<script type="text/javascript" src="../js/groups.js"></script>
<link rel="stylesheet" type="text/css" href="../lib/foundation/dist/foundation.min.css"/>
<link rel="stylesheet" type="text/css" href="../css/page.css"/>

<!--
<link rel="shortcut icon" href="../images/favicon.ico" />
-->
</head>

<body>
<div class="off-canvas-wrapper">
<div class="off-canvas-wrapper-inner" data-off-canvas-wrapper>

<div class="off-canvas position-left" id="off-canvas-menu" data-off-canvas>
<nav class="off-canvas-nav">
<div class="nav-home">
<a href="../index.html" >
<span class="home-icon">⌂</span>Blindsight
</a>
<div class="version-number">
0.1.35
</div>
</div>
<div class="nav-toc">
<ul>
  <li><a href="../setup/index.html" class="page">Setup</a>
  <ul>
    <li><a href="../setup/logback.html" class="page">Logback</a></li>
    <li><a href="../setup/generic.html" class="page">Generic</a></li>
  </ul></li>
  <li><a href="../usage/index.html" class="page">Usage</a>
  <ul>
    <li><a href="../usage/overview.html" class="page">Overview</a></li>
    <li><a href="../usage/resolvers.html" class="page">Logger Resolvers</a></li>
    <li><a href="../usage/slf4j.html" class="page">SLF4J API</a></li>
    <li><a href="../usage/fluent.html" class="page">Fluent API</a></li>
    <li><a href="../usage/semantic.html" class="page">Semantic API</a></li>
    <li><a href="../usage/flow.html" class="page">Flow API</a></li>
    <li><a href="../usage/structured.html" class="active page">Structured Logging</a></li>
    <li><a href="../usage/conditional.html" class="page">Conditional Logging</a></li>
    <li><a href="../usage/context.html" class="page">Contextual Logging</a></li>
    <li><a href="../usage/sourcecode.html" class="page">Source Code</a></li>
  </ul></li>
  <li><a href="../extending/index.html" class="page">Extending</a>
  <ul>
    <li><a href="../extending/overview.html" class="page">Overview</a></li>
  </ul></li>
</ul>
</div>

</nav>
</div>

<div class="off-canvas-content" data-off-canvas-content>

<header class="site-header expanded row">
<div class="small-12 column">
<a href="#" class="off-canvas-toggle hide-for-medium" data-toggle="off-canvas-menu"><svg class="svg-icon svg-icon-menu" version="1.1" id="Menu" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 20 20" enable-background="new 0 0 20 20" xml:space="preserve"> <path class="svg-icon-menu-path" fill="#53CDEC" d="M16.4,9H3.6C3.048,9,3,9.447,3,10c0,0.553,0.048,1,0.6,1H16.4c0.552,0,0.6-0.447,0.6-1C17,9.447,16.952,9,16.4,9z M16.4,13
H3.6C3.048,13,3,13.447,3,14c0,0.553,0.048,1,0.6,1H16.4c0.552,0,0.6-0.447,0.6-1C17,13.447,16.952,13,16.4,13z M3.6,7H16.4
C16.952,7,17,6.553,17,6c0-0.553-0.048-1-0.6-1H3.6C3.048,5,3,5.447,3,6C3,6.553,3.048,7,3.6,7z"/></svg>
</a>
<div class="title"><a href="../index.html">Blindsight</a></div>

<!--
<a href="https://www.example.com" class="logo show-for-medium">logo</a>
-->
</div>
</header>

<div class="expanded row">

<div class="medium-3 large-2 show-for-medium column">
<nav class="site-nav">
<div class="nav-home">
<a href="../index.html" >
<span class="home-icon">⌂</span>Blindsight
</a>
<div class="version-number">
0.1.35
</div>
</div>
<div class="nav-toc">
<ul>
  <li><a href="../setup/index.html" class="page">Setup</a>
  <ul>
    <li><a href="../setup/logback.html" class="page">Logback</a></li>
    <li><a href="../setup/generic.html" class="page">Generic</a></li>
  </ul></li>
  <li><a href="../usage/index.html" class="page">Usage</a>
  <ul>
    <li><a href="../usage/overview.html" class="page">Overview</a></li>
    <li><a href="../usage/resolvers.html" class="page">Logger Resolvers</a></li>
    <li><a href="../usage/slf4j.html" class="page">SLF4J API</a></li>
    <li><a href="../usage/fluent.html" class="page">Fluent API</a></li>
    <li><a href="../usage/semantic.html" class="page">Semantic API</a></li>
    <li><a href="../usage/flow.html" class="page">Flow API</a></li>
    <li><a href="../usage/structured.html" class="active page">Structured Logging</a></li>
    <li><a href="../usage/conditional.html" class="page">Conditional Logging</a></li>
    <li><a href="../usage/context.html" class="page">Contextual Logging</a></li>
    <li><a href="../usage/sourcecode.html" class="page">Source Code</a></li>
  </ul></li>
  <li><a href="../extending/index.html" class="page">Extending</a>
  <ul>
    <li><a href="../extending/overview.html" class="page">Overview</a></li>
  </ul></li>
</ul>
</div>

</nav>
</div>

<div class="small-12 medium-9 large-10 column">
<section class="site-content">

<span id="version-warning"></span>

<div class="page-header row">
<div class="medium-12 show-for-medium column">
<div class="nav-breadcrumbs">
<ul>
  <li><a href="../index.html">Blindsight</a></li>
  <li><a href="../usage/index.html">Usage</a></li>
  <li>Structured Logging</li>
</ul>
</div>
</div>
</div>

<div class="page-content row">
<div class="small-12 large-9 column" id="docs">
<h1><a href="#structured-logging" name="structured-logging" class="anchor"><span class="anchor-link"></span></a>Structured Logging</h1>
<p>Structured logging is the basis for logging rich events. <code>logstash-logback-encoder</code> has <a href="https://github.com/logstash/logstash-logback-encoder#event-specific-custom-fields">Markers and StructuredArguments</a> which will write out markers and arguments to a <a href="https://github.com/logstash/logstash-logback-encoder#encoders--layouts">JSON encoder</a> while still enabling line oriented output to console and file appenders.</p><div class="callout note "><div class="callout-title">Note</div>
<p>See <a href="https://tersesystems.github.io/terse-logback/">Terse Logback</a> and the <a href="https://github.com/tersesystems/terse-logback-showcase">Terse Logback Showcase</a> for examples of how to configure logstash-logback-encoder for JSON.</p></div>
<p>You can set up structured logging using Logstash Markers and StructuredArguments, but you don&rsquo;t have to. Blindsight comes with bindings of <a href="/blindsight/api/com/tersesystems/blindsight/api/ToMarkers.html" title="com.tersesystems.blindsight.api.ToMarkers"><code>ToMarkers</code></a> and <a href="/blindsight/api/com/tersesystems/blindsight/api/ToArguments.html" title="com.tersesystems.blindsight.api.ToArguments"><code>ToArguments</code></a> to <a href="https://github.com/logstash/logstash-logback-encoder#event-specific-custom-fields">Logstash Markers and StructuredArguments</a>. This lets you be far more expressive in constructing markers and arguments, and lets you pack far more information in.</p>
<p>For example, Logstash Markers has the concept of a &ldquo;key=value&rdquo; pair that gets written out to JSON using <code>append</code>. We can create a type class to represent that as a tuple:</p>
<pre class="prettyprint"><code class="language-scala">trait LowPriorityMarkers {
  implicit val tupleStringToMarkers: ToMarkers[(String, String)] = ToMarkers {
    case (k, v) =&gt;
      Markers(LogstashMarkers.append(k, v))
  }
}
object Implicits extends LowPriorityMarkers
</code></pre>
<p>And then we can do the following in the fluent API:</p>
<pre class="prettyprint"><code class="language-scala">import com.tersesystems.blindsight.logstash.Implicits._
logger.info(&quot;userId&quot; -&gt; userId, &quot;Logging with user id added as a marker!&quot;)
</code></pre>
<p>From there, you can build up structured logging statements and rely on the type class mappings, for example:</p>
<pre class="prettyprint"><code class="language-scala">import com.tersesystems.blindsight.logstash.Implicits._

val tupleStringMarker = Markers(&quot;string&quot; -&gt; &quot;steve&quot;)
val tupleNumberMarker = Markers(&quot;number&quot; -&gt; 42)
val tupleBooleanNumber = Marker(&quot;boolean&quot; -&gt; true)
val arrayMarker = Markers(&quot;array&quot; -&gt; Seq(&quot;one&quot;, &quot;two&quot;, &quot;three&quot;))

val tupleStringArguments = Arguments(&quot;arg1&quot; -&gt; &quot;value1&quot;)
val tupleNumberArguments = Arguments(&quot;numericArg&quot; -&gt; 42)
val tupleBooleanArguments = Arguments(&quot;booleanArg&quot; -&gt; false)
val mapArguments = Arguments(Map(&quot;a&quot; -&gt; &quot;b&quot;))
val arrayArguments = Arguments(&quot;sequenceArg&quot; -&gt; Seq(&quot;a&quot;, &quot;b&quot;, &quot;c&quot;))
</code></pre>
<p>You can also extend arguments and maarkers using your own type class instances. This is especially useful when you already have structured logging, and want to pass it through without changes, since logstash-logback-encoder supports JsonNode transparently.</p>
<p>For example, if you are working with json4s or play-json, you can convert to Jackson JsonNode using a type class:</p>
<pre class="prettyprint"><code class="language-scala">import com.fasterxml.jackson.databind.JsonNode

trait ToJsonNode[T] {
  def jsonNode(instance: T): JsonNode
}

object ToJsonNode {
  import org.json4s._

  implicit val json4sToJsonNode: ToJsonNode[JValue] = new ToJsonNode[JValue] {
    import org.json4s.jackson.JsonMethods._
    override def jsonNode(instance: JValue): JsonNode = asJsonNode(instance)
  }
}
</code></pre>
<p>And then set up your own type mappings as follows:</p>
<pre class="prettyprint"><code class="language-scala">implicit def jsonToArguments[T: ToJsonNode]: ToArguments[(String, T)] = ToArguments {
  case (k, instance) =&gt;
    val node = implicitly[ToJsonNode[T]].jsonNode(instance)
    Arguments(StructuredArguments.keyValue(k, node)) // or raw(k, node.toPrettyString)
}

import org.json4s._
import org.json4s.jackson.JsonMethods._

val arguments = Arguments(&quot;markerJson&quot; -&gt; parse(&quot;&quot;&quot; { &quot;numbers&quot; : [1, 2, 3, 4] } &quot;&quot;&quot;))
logger.info(&quot;This message has json {}&quot;, arguments)
</code></pre>
<div class="source-github">
The source code for this page can be found <a href="https://github.com/tersesystems/blindsight/tree/v0.1.35/docs/src/main/paradox/usage/structured.md">here</a>.
</div>

<div class="nav-next">
<p><strong>Next:</strong> <a href="../usage/conditional.html">Conditional Logging</a></p>
</div>
</div>
<div class="large-3 show-for-large column" data-sticky-container>
</div>
</div>

</section>
</div>

</div>

<footer class="site-footer">

<section class="site-footer-nav">
<div class="expanded row">
<div class="small-12 large-offset-2 large-10 column">
<div class="row site-footer-content">

<div class="small-12 medium-4 large-3 text-center column">
<div class="nav-links">
<ul>
<!-- <li><a href="https://www.example.com/products/">Products</a> -->
</ul>
</div>
</div>

</div>
</div>
</div>
</section>

<section class="site-footer-base">
<div class="expanded row">
<div class="small-12 large-offset-2 large-10 column">
<div class="row site-footer-content">

<div class="small-12 text-center large-9 column">

<!--
<div class="copyright">
<span class="text">&copy; 2020</span>
<a href="https://www.example.com" class="logo">logo</a>
</div>
-->
</div>

</div>
</div>
</div>
</section>
</footer>

</div>
</div>
</div>
</body>

<script type="text/javascript" src="../lib/foundation/dist/foundation.min.js"></script>
<script type="text/javascript">jQuery(document).foundation();</script>
<script type="text/javascript" src="../js/magellan.js"></script>

<style type="text/css">@import "../lib/prettify/prettify.css";</style>
<script type="text/javascript" src="../lib/prettify/prettify.js"></script>
<script type="text/javascript" src="../lib/prettify/lang-scala.js"></script>
<script type="text/javascript">jQuery(function(){window.prettyPrint && prettyPrint()});</script>
<script type="text/javascript">jQuery(function(jq){initOldVersionWarnings(jq, '0.1.35', 'https://tersesystems.github.io/blindsight')});</script>


</html>
